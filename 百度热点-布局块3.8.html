<!doctype html>
<html>
 <head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style type="text/css">
html {
	font-family: arial,Hiragino Sans GB,Microsoft Yahei,"微软雅黑",Tahoma,Helvetica,STHeiti;
	background:#ccc
}
#header {
	height: 75pt
}
#logo {
	margin-left: 75pt
}
#nav {
	overflow: hidden;
	height: 40px;
	background: #001e6a;
	text-align: center;
	opacity: .8
}
#menu,#nav {
	position: relative
}
#menu {
	margin: 0 0 0 100px;
	padding: 0;
	list-style: none
}
.submenu {
	float: left;
	display: inline-block;
	width: 60px;
	color: #fff;
	line-height: 36px;
	cursor: pointer
}
.m_mark {
	position: absolute;
	z-index: -1;
	background: #c00;
	transition: all .4s ease
}
.m_mark,.submenu {
	margin: 2px 0;
	height: 36px;
	border-radius: 3px
}
#main {
	margin: 10px 0
}
#demo {
	position: relative;
	margin: 0 auto
}
#demo ul {
	margin: 0;
	padding: 0;
	list-style: none
}
.block {
	position: absolute;
	display: inline-block;
	overflow: hidden;
	opacity: .9
}
.block,.cont {
	border-radius: 3px
}
.cont {
	position: relative;
	display: table-cell;
	padding: 0 5px;
	vertical-align: middle;
	text-align: center
}
.cont span {
	display: block;
	color: #ddd
}
.mark {
	position: absolute;
	top: 100%;
	left: 0;
	width: 100%;
	height: 0;
	border-radius: 0;
	transition: .4s ease-in-out
}
.mark a {
	display: table-cell;
	padding: 0 5px;
	color: #aaa;
	vertical-align: middle;
	text-decoration: none;
	font-size: 1.4vw
}
.mark .title {
	color: #fff;
	font-weight: 500
}
.block:hover .mark {
	top: 0;
	left: 0;
	height: 100%;
	border-radius: 3px;
	background: #000;
	opacity: .92
}
#datenav {
	height: 40px;
}
#dnav {
	margin: 0;
	margin: 0 auto;
	padding: 0;
	width: 35pc;
	list-style: none
}
#refresh {
	float: left;
	margin: 2px 20px;
	width: 40px;
	height: 40px;
	border-radius: 10px;
	background: #a6c8c6;
	text-align: center;
	cursor: pointer
}
#refresh img {
position:relative;left:-5px;top:-5px;
	opacity: .8
}
.dnav {
	display: inline-block;
	margin: 5px;
	width:5pc;
	height: 30px;
	border-radius: 10px;
	background: #a6c8c6;
	color: #666;
	text-align: center;
	line-height: 30px;
	cursor: pointer
}
#refresh:hover {
	background: #3a8bda
}
#refresh:hover img {
	opacity: .9
}
.dnav:hover {
	background: #3a8bda;
	color: #ddd;
	opacity: .6;
	transition: all .2s ease-in
}
.mactive {
	background: #c00;
	color: #fff
}
.dactive {
	background: #3a8bda;
	color: #ddd
}
#footer {
	color: #111;
	text-align:center;
}
  </style>
 </head>
 <body>
 <div id="header">
	<div id="logo">
<!-- 	<img src="2.png" height="100px" align="middle"><img src="22.png" height="75px" align="middle">
 -->	</div>
 </div>
 <div id="nav">
	<ul id="menu">
		<div class="m_mark" ></div>
		<li hot="0" class="submenu mactive">全部</li>
		<li hot="2" class="submenu">国内</li>
		<li hot="1" class="submenu">国际</li>
		<li hot="5" class="submenu">社会</li>
		<li hot="14" class="submenu">军事</li>
		<li hot="6" class="submenu">财经</li>
		<li hot="10" class="submenu">汽车</li>
		<li hot="8" class="submenu">科技</li>
		<li hot="4" class="submenu">娱乐</li>
		<li hot="3" class="submenu">体育</li>
	</ul>
 </div>
 <div id="main">
	<div id="demo">
	<ul>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
		<li class="block"><div class='cont'></div><div class='mark'></div></li>
	</ul>
	</div>
	<div id="datenav">
	<ul id="dnav">
		<div id="refresh" title="刷新"><!-- <img src="refresh.png" /> --></div>
		<li class="dnav"></li>
		<li class="dnav"></li>
		<li class="dnav"></li>
		<li class="dnav"></li>
		<li class="dnav dactive"></li>
	</ul>
	</div>
 </div>
 <div id="footer">
 <hr>
<div id="copyright" >CopyRight @ ritan 2016</div>
 </div>
<script src="./jquery-3.1.1.min.js"></script>
<script>
//-------------------------------------------
	var rtian={//-------初始化参数
		_row:2,
		_col:4,
		_split:6,
		_hot:0,
		_date:'',
		_bwidth:($(window).width()-200)/8,
		_count:21,//和_block的数量保持一致
		_posi:[],
		_json:[],
		_color:['#1A4335','#08689F','#1188D4','#A5231F','#4E47A9','#E28618','#1883E2','#204AC9'],
	};
	rtian._block=[
		[{bclass :'d',posi :[0,0]}],
		[{bclass :'a',posi :[0,0]},{bclass :'a',posi :[1,0]},{bclass :'a',posi :[0,1]},{bclass :'a',posi :[1,1]}],
		[{bclass :'a',posi :[0,0]},{bclass :'b',posi :[1,0]},{bclass :'a',posi :[0,1]}],
		[{bclass :'b',posi :[0,0]},{bclass :'a',posi :[1,0]},{bclass :'a',posi :[1,1]}],
		[{bclass :'a',posi :[0,0]},{bclass :'a',posi :[1,0]},{bclass :'c',posi :[0,1]}],
		[{bclass :'c',posi :[0,0]},{bclass :'a',posi :[0,1]},{bclass :'a',posi :[1,1]}],
		[{bclass :'b',posi :[0,0]},{bclass :'b',posi :[1,0]}],
		[{bclass :'c',posi :[0,0]},{bclass :'c',posi :[0,1]}],
		];
	rtian.setPosi=function(){
		var e=this,
			n=0;
        e._block = e._block.sort(function() {
            return Math.random() > 0.5 ? 1 : -1;
        });
		for (var i=0;i<e._row ;i++ ){
			for (var ii=0;ii<e._col ;ii++ ){
				var ablock=e._block[i*e._col+ii];
				for (var j=0;j<ablock.length ; j++){
					e._posi[n]= e._posi[n] || {};
					e._posi[n].c=ablock[j].bclass;
					e._posi[n].p=[ablock[j].posi[0]*e._bwidth + ii*e._bwidth*2 , ablock[j].posi[1]*e._bwidth*0.75 + i*e._bwidth*1.5];
					n++;
				}
			}
		}
	};
	rtian.setBlock=function(){
		var e=this;
		$('.block').each(function(i,el){
				$(el).removeClass('a b c d');
				$(el).addClass(e._posi[i].c);
				$(el).css({'background':e._color[Math.floor(Math.random() * 8)],'transform':'translate('  + e._posi[i].p[0] + 'px,'  + e._posi[i].p[1] + 'px)'});
			});
	};
	rtian.setContent=function(){
		var e=this,
		s = 'http://news.baidu.com/ns?tn=news&word=';
        e._json = e._json.sort(function() {
            return Math.random() > 0.5 ? 1 : -1;
        });
		$('.cont').removeClass('a b c d');
		$('.mark').removeClass('a b c d');
		$('.cont').each(function(i,el){
				var title=e._json[i].title.replace('[br]','<br>'),
					query_word=e._json[i].query_word,
					desc=e._json[i].desc,
					ec=e._posi[i].c,
					content='<span>' + title + '</span>';
				$(el).addClass(ec);
				$('.mark').eq(i).addClass(ec);
					$(el).html( content );
					if (ec != 'a')
						{
						$(el).next('.mark').html('<a class=\'' + ec + '\'  target=\'_blank\' href=\'' + s + query_word + '\'><span class=\'title\'>' + title + '</span><br><span>' + desc + '</span></a>');
						}else{
							if (desc == '')
							{desc = title;
							}
						$(el).next('.mark').html('<a  class=\'' + ec + '\'  target=\'_blank\' href=\'' + s + query_word + '\'><span>' + desc + '</span></a>');
						}
		});
	};
	rtian.block_format=function(){
		var e=this;
		$('#demo').css({'width':e._bwidth*8 + 'px','height':(e._bwidth*3 + e._split) + 'px' });
		$('.a').css({'width':(e._bwidth-e._split) + 'px','height':(e._bwidth*0.75-e._split) + 'px'});
		$('.b').css({'width':(e._bwidth-e._split) + 'px','height':(e._bwidth*1.5-e._split) + 'px'});
		$('.c').css({'width':(e._bwidth*2-e._split) + 'px','height':(e._bwidth*0.75-e._split) + 'px'});
		$('.d').css({'width':(e._bwidth*2-e._split) + 'px','height':(e._bwidth*1.5-e._split) + 'px'});
	};
	rtian.cont_format=function(){
		var e=this;
		$('.block .a').css({'width':(e._bwidth-e._split) + 'px','height':(e._bwidth*0.75-e._split) + 'px'});
		$('.block .b').css({'width':(e._bwidth-e._split) + 'px','height':(e._bwidth*1.5-e._split) + 'px'});
		$('.block .c').css({'width':(e._bwidth*2-e._split) + 'px','height':(e._bwidth*0.75-e._split) + 'px'});
		$('.block .d').css({'width':(e._bwidth*2-e._split) + 'px','height':(e._bwidth*1.5-e._split) + 'px'});
		$('.cont.a').attr({'bh':(e._bwidth*0.75-e._split),'bw':(e._bwidth-e._split) } );
		$('.cont.b').attr({'bh':(e._bwidth*1.5-e._split),'bw':(e._bwidth-e._split) });
		$('.cont.c').attr({'bh':(e._bwidth*0.75-e._split),'bw':(e._bwidth*2-e._split) } );
		$('.cont.d').attr({'bh':(e._bwidth*1.5-e._split),'bw':(e._bwidth*2-e._split) }  );
		$('.cont span').each(function(i){
			var fsize=1.5;
			$(this).css('font-size', fsize + 'vw');
			while(this.scrollHeight < $(this).parent().attr('bh')){
				fsize=fsize + 0.1;
				$(this).css('font-size', fsize + 'vw');
			}
			fsize=fsize-0.1;
			while(this.scrollWidth > $(this).parent().attr('bw')){
				fsize=fsize - 0.1;
				$(this).css('font-size', fsize + 'vw');
			}
			$(this).css('font-size', (fsize-0.1) + 'vw');
		});
	};
	rtian.getdata=function(){
		var e=this;
		if (sessionStorage.getItem('hot-' + e._hot + '-' + e._date) == null)
		{
			
			$.ajax({
				url:'getjson.asp?type=' + e._hot + '&date=' + e._date,
				type:'get',
				async:false,
				success:function(data){
				var d=ascii2native(data);
				sessionStorage.setItem('hot-' + e._hot + '-' + e._date,(d));
				e._json=JSON.parse(d).data;
				}
			});
		}else{
				e._json=JSON.parse(sessionStorage.getItem('hot-' + e._hot + '-' + e._date)).data;
		}
	};
	rtian.menu=function(){
		var e=this;
		$('.m_mark').css({'left':$('.mactive').position().left + 'px','width':$('.mactive').width() + 'px'});
		$('.submenu').hover(function(){
			$('.m_mark').css({'left':$(this).position().left + 'px','width':$(this).width() + 'px'});
		
		},function(){
		$('.m_mark').css({'left':$('.mactive').position().left + 'px','width':$('.mactive').width() + 'px'});
		});
	};
	rtian.datelist=function(){
		var e=this;
		var myDate = new Date(),
		y=myDate.getFullYear(),
		m=myDate.getMonth(),
		d=myDate.getDate();   
		$('#dnav li').each(function(i,el){
			var dl=new Date(y,m,(d + i -4));
			$(el).html(dl.format('M月d日'));
			$(el).attr('date',dl.format('yyyyMMdd'));
		});
		e._date=myDate.format('yyyyMMdd');
	};
	rtian.redraw=function(){
		var e=this;
		e.setPosi();
		e.setBlock();
		e.block_format();
		// e.getdata();
		// e.setContent();
		// e.cont_format();
	};
//----------------页面事件--------------------------------
	$('#refresh').on('click',function(){
		rtian.redraw();
	});
	$(window).on('resize',function(){
		var	bw=($(window).width()-200)/8;
		rtian._bwidth=bw;
		rtian.redraw();
	});
	$('#menu li').each(function(i,e){
		$(e).on('click',function(){
			$('.submenu').removeClass('mactive');
			$(e).addClass('mactive');
			rtian._hot=$(e).attr('hot');
			rtian.redraw();
		});
	});
	$('#dnav li').each(function(i,e){
		$(e).on('click',function(){
			$('.dnav').removeClass('dactive');
			$(e).addClass('dactive');
			rtian._date=$(e).attr('date');
			rtian.redraw();
		});
	});
	$('#demo').on('mousewheel',function(){
		rtian.redraw();
	});
//-----------------------------
	$(function(){
		var e=rtian;
			e.menu();
			e.datelist();
			e.redraw();
			$('.block').css({'transition':'transform .3s ease-in-out'});
	});




//--------------------函数区------------------------------------------
	// 对Date的扩展，将 Date 转化为指定格式的String 
	// 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符， 
	// 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字) 
	// 例子： 
	// (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423 
	// (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18 
	Date.prototype.format = function(fmt) 
	{ 
	  var o = { 
		'M+' : this.getMonth()+1,                 //月份 
		'd+' : this.getDate(),                    //日 
		'h+' : this.getHours(),                   //小时 
		'm+' : this.getMinutes(),                 //分 
		's+' : this.getSeconds(),                 //秒 
		'q+' : Math.floor((this.getMonth()+3)/3), //季度 
		'S'  : this.getMilliseconds()             //毫秒 
	  }; 
	  if(/(y+)/.test(fmt)) 
		fmt=fmt.replace(RegExp.$1, (this.getFullYear()+'').substr(4 - RegExp.$1.length)); 
	  for(var k in o) 
		if(new RegExp('('+ k +')').test(fmt)) 
	  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (('00'+ o[k]).substr((''+ o[k]).length))); 
	  return fmt; 
	};
	function ascii2native(str){
		var asciicode = str.split('\\u');
		var nativeValue = asciicode[0];
		for (var i = 1; i < asciicode.length; i++) {
			var code = asciicode[i];
			nativeValue += String.fromCharCode(parseInt('0x' + code.substring(0, 4)));
			if (code.length > 4) {
				nativeValue += code.substring(4, code.length);
			}
		}	
		return (nativeValue);
	}
//-------------------
</script>
 </body>
</html>
